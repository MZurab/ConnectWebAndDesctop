<div id="msgId-testToMeLiveAudio" class="messagesInChatView  toMeMessageInChatView msgTypeLiveAudio" time-sent="" time-read="" time-delivered="" connect_msg="" connect-appear-scroll-parent="#leftBlockInViewWindow" connect-appear-my-parent=".ChatViewInAppWindow">
   <div class="lineInToMeMessage">
      <div class="lineInBoxInLine">
         <div class="topCircleInMessages"></div>
         <div class="timeTopInMessages">04:12</div>
         <div class="botCircleInMessages" title="04:12"></div>
         <div class="timeBotInMessages">04:12</div>
      </div>
   </div>


   <div class="aCpI_msgLiveAudio_contentAudioInToMeMessage aCpI_msgLiveAudio_contentOfAudioMessage" onmousemove="aCpI_msgLiveAudio_onHover(event, this)" onmouseout="aCpI_msgLiveAudio_onMouseOut(this)" onclick="aCpI_msgLiveAudio_onClick(event,this)">
      <div class="aCpI_msgLiveAudio_audioMsgPlayedBlock">
         <div class="aCpI_msgLiveAudio_playedSpritesInAudioMsg"></div>
      </div>
      <div class="aCpI_msgLiveAudio_backgroundForAudioMsg aCpI_msgLiveAudio_backgroundForAudioMsgToMe"></div>
      <div class="aCpI_msgLiveAudio_backgroundForAudioMsgOnHover"></div>
      <div class="aCpI_msgLiveAudio_blockInAudioMsg">
         <div class="aCpI_msgLiveAudio_iconInAudioMessage"></div>
         <div class="aCpI_msgLiveAudio_viewWhenLoadingLiveAudioMsg"></div>
         <div class="aCpI_msgLiveAudio_controllPlayInAudioMessage" onclick="aCpI_msgLiveAudio_playAudioOnClickBtnPlay(this,event)"></div>
         <div class="aCpI_msgLiveAudio_controllPauseInAudioMessage" onclick="aCpI_msgLiveAudio_pauseAudioOnClickBtnPause(this,event)"></div>
         <div class="aCpI_msgLiveAudio_hideAudioBlock">
            <audio class="audioSrc flagAudioOrVideoElement" onplay="aCpI_msgLiveAudio_onEventPlay(this)" onpause="aCpI_msgLiveAudio_onEventPause(this)" preload="auto" src="https://firebasestorage.googleapis.com/v0/b/connect-9109d.appspot.com/o/public%2F5.mp3?alt=media&token=3d9a5872-cf9a-4ef1-85c3-f8deda4be672" onloadeddata="aCpI_msgLiveAudio_onEventLoadedAudio(this)" ontimeupdate="aCpI_msgLiveAudio_onEventTimeUpdateForAuidioEl(this)"></audio>
         </div>
         <div class="aCpI_msgLiveAudio_timeNowInAudioMessage aCpI_msgLiveAudio_timeInAudioMsg"></div>
         <div class="aCpI_msgLiveAudio_timeAllInAudioMessage aCpI_msgLiveAudio_timeInAudioMsg"></div>
      </div>
   </div>
</div>


<div id="msgId-testFromMeLiveAudio" class="messagesInChatView  fromMeMessageInChatView msgTypeLiveAudio" time-sent="" time-read="" time-delivered="" connect_msg="testAudio" connect-appear-scroll-parent="#leftBlockInViewWindow" connect-appear-my-parent=".ChatViewInAppWindow">
   <div class="lineInFromMeMessage">
      <div class="lineInBoxInLine">
         <div class="topCircleInMessages"></div>
         <div class="timeTopInMessages">04:12</div>
         <div class="botCircleInMessages" title="04:13"></div>
         <div class="timeBotInMessages">04:12</div>
      </div>
   </div>
   <div class="aCpI_msgLiveAudio_contentAudioInFromMeMessage aCpI_msgLiveAudio_contentOfAudioMessage" onmousemove="aCpI_msgLiveAudio_onHover(event, this)" onmouseout="aCpI_msgLiveAudio_onMouseOut(this)" onclick="aCpI_msgLiveAudio_onClick(event,this)">
      <div class="aCpI_msgLiveAudio_audioMsgPlayedBlock">
         <div class="aCpI_msgLiveAudio_playedSpritesInAudioMsg"></div>
      </div>
      <div class="aCpI_msgLiveAudio_backgroundForAudioMsg aCpI_msgLiveAudio_backgroundForAudioMsgFromMe"></div>
      <div class="aCpI_msgLiveAudio_backgroundForAudioMsgOnHover"></div>
      <div class="aCpI_msgLiveAudio_blockInAudioMsg">
         <div class="aCpI_msgLiveAudio_iconInAudioMessage"></div>
         <div class="aCpI_msgLiveAudio_viewWhenLoadingLiveAudioMsg"></div>
         <div class="aCpI_msgLiveAudio_controllPlayInAudioMessage" onclick="aCpI_msgLiveAudio_playAudioOnClickBtnPlay(this,event)"></div>
         <div class="aCpI_msgLiveAudio_controllPauseInAudioMessage" onclick="aCpI_msgLiveAudio_pauseAudioOnClickBtnPause(this,event)"></div>
         <div class="aCpI_msgLiveAudio_hideAudioBlock">
            <audio class="audioSrc flagAudioOrVideoElement" onplay="aCpI_msgLiveAudio_onEventPlay(this)" onpause="aCpI_msgLiveAudio_onEventPause(this)" preload="auto" src="https://firebasestorage.googleapis.com/v0/b/connect-9109d.appspot.com/o/public%2F6.mp3?alt=media&token=898413c4-f5ff-4d0a-8668-0a26b0fffffc" onloadeddata="aCpI_msgLiveAudio_onEventLoadedAudio(this)" ontimeupdate="aCpI_msgLiveAudio_onEventTimeUpdateForAuidioEl(this)"></audio>
         </div>
         <div class="aCpI_msgLiveAudio_timeNowInAudioMessage aCpI_msgLiveAudio_timeInAudioMsg"></div>
         <div class="aCpI_msgLiveAudio_timeAllInAudioMessage aCpI_msgLiveAudio_timeInAudioMsg"></div>
      </div>
   </div>
</div>



<style type="text/css">
	/*@< codeKey = aCpI - appChatPageIndex  */
		.aCpI_msgLiveAudio_contentAudioInToMeMessage {
		    height: 4rem;
		    max-width: 80%;
		    display: block;
		    width: 25rem;
		    margin-left: 0.9rem;
		    background: white;
		    border-radius: 0 0.3rem 0.3rem 0;
		    font-size: 1.2rem;
		    float: left;
		    position: relative;
		}
			.aCpI_msgLiveAudio_userNameBlockInAudioMsg {
			    position: absolute;
			    font-size: 0.9rem;
			    top: -1.2rem;
			    right: 0px;
			    color: #1cb5e1;
			    font-weight: 900;
			    font-family: sans-serif;
			}
			/*ms*/
			.aCpI_msgLiveAudio_audioMsgPlayedBlock {
			    position: absolute;
			    width: 100%;
			    bottom: -0.25rem;
			    height: 0.25rem;
			    display: none; /* CHANGE - add spy*/
			}
			.aCpI_msgLiveAudio_playedSpritesInAudioMsg {
			    background-color: rgb(36, 208, 168);
			    height: 100%;
			    position: absolute;
			    width: 100%;
			    left: 0%;
			}
			/**/
			.aCpI_msgLiveAudio_backgroundForAudioMsgFromMe {
			    background: rgba(255, 0, 59, 0.25);
			}
			.aCpI_msgLiveAudio_backgroundForAudioMsgToMe {
			    background: rgba(28, 181, 225, 0.4);
			}
			.aCpI_msgLiveAudio_backgroundForAudioMsg {
			    height: 100%;
			    width: 0%;
			    position: absolute;
			    border-radius: inherit;

			}

			.aCpI_msgLiveAudio_backgroundForAudioMsgOnHover {
			    position: absolute;
			    height: 100%;
			    width: 0%;
			    background: rgba(114, 93, 149, 0.15);
			    border-radius: inherit;
			}

			.aCpI_msgLiveAudio_blockInAudioMsg {
			    width: 100%;
			    height: 100%;
			    position: relative;
			    margin: 0.25rem;
			}
				.aCpI_msgLiveAudio_iconInAudioMessage {
				    width: 3.5rem;
				    height: 3.5rem;
				    background-image: url(https://cdn.ramman.net/images/icons/users/zurab.jpg);
				    background-size: 100%;
				    border-radius: 100%;
				    position: absolute;
				    top: 0px;
				    left: 0px;
				}
				.aCpI_msgLiveAudio_viewWhenLoadingLiveAudioMsg {
				    position: absolute;
				    width: 3.2rem;
				    height: 3.2rem;
				    left: 3.7rem;
				    top: 0.2rem;
				    background-image: url(https://cdn.ramman.net/web/res/gif/messages/live/liveAudioLoading_256_256.gif);
				    background-size: 100% 100%;
				    background-position-x: 198%;
				    cursor: pointer;
				}
				.aCpI_msgLiveAudio_controllPlayInAudioMessage {
				    position: absolute;
				    width: 2.5rem;
				    height: 2.5rem;
				    left: 4rem;
				    top: 0.6rem;
				    background-image: url(https://cdn.ramman.net/web/res/images/icons/message/audio/sprite.png);
				    background-size: auto 200%;
				    background-position-x: 198%;
				    cursor: pointer;
				    display: none;
				}
				.aCpI_msgLiveAudio_controllPauseInAudioMessage {
				    position: absolute;
				    width: 2.5rem;
				    height: 2.5rem;
				    left: 4rem;
				    top: 0.5rem;
				    background-image: url(https://cdn.ramman.net/web/res/images/icons/message/audio/sprite.png);
				    background-size: auto 200%;
				    background-position-x: 198%;
				    background-position-y: 100%;
				    cursor: pointer;
				    display:none;
				}
				.aCpI_msgLiveAudio_hideAudioBlock {
					display: none;
				}
				.aCpI_msgLiveAudio_timeInAudioMsg {
				    font-size: 0.9rem;
				    position: absolute;
				    bottom: 0.5rem;
				    font-family: sans-serif;
				}
				.aCpI_msgLiveAudio_timeNowInAudioMessage {
				    left: 7rem;
				}
				.aCpI_msgLiveAudio_timeAllInAudioMessage {
				    right: 0.5rem;
				}

		.aCpI_msgLiveAudio_contentAudioInFromMeMessage {
		    height: 4rem;
		    max-width: 80%;
		    display: block;
		    width: 25rem;
		    margin-right: 0.9rem;
		    background: white;
		    border-radius: 0.3rem 0 0 0.3rem;
		    font-size: 1.2rem;
		    float: right;
		    position: relative;
		}
		.aCpI_msgLiveAudio_contentOfAudioMessage {
			cursor: pointer;
		}
	/*@> codeKey = aCpI - appChatPageIndex  */
</style>

<script type="text/javascript">

	//@< global
		function aCpI_msg_pauseAllOtherPlayingAudioOrVideoEl () {
			$('.flagForSearchPlayingAudioOrVideo').each(
				function (i,thisEl)  {
					$(this).get(0).pause()
				}
			);
		}
	//@> global

	//@< codeKey = appChatPageIndex - aCpI
		function aCpI_msgLiveAudio_onEventLoadedAudio (iNthis) {

			// parent blockInAudioMsg
			let parentBlockInAudioMsg = $(iNthis).closest('.aCpI_msgLiveAudio_blockInAudioMsg');
			// hide loader
			parentBlockInAudioMsg.find('.aCpI_msgLiveAudio_viewWhenLoadingLiveAudioMsg').hide();
			// view play btn
			parentBlockInAudioMsg.find('.aCpI_msgLiveAudio_controllPlayInAudioMessage').show();

			// set now time
			aCpI_msgLiveAudio_setNowTextTimeForAudioNow (iNthis);

			// set duration
			aCpI_msgLiveAudio_setDurationTextTimeForAudioNow (iNthis);
		}
			function aCpI_msgLiveAudio_setNowTextTimeForAudioNow (iNthis) {
				var nowTextTime = moment( (iNthis.currentTime * 1000) || 0).format('mm:ss');
				$(iNthis).closest('.aCpI_msgLiveAudio_blockInAudioMsg').find('.aCpI_msgLiveAudio_timeNowInAudioMessage').html( nowTextTime );
			}
			function aCpI_msgLiveAudio_setDurationTextTimeForAudioNow (iNthis) {
				var durationTextTime = moment( (iNthis.duration * 1000) || 0 ).format('mm:ss');
				$(iNthis).closest('.aCpI_msgLiveAudio_blockInAudioMsg').find('.aCpI_msgLiveAudio_timeAllInAudioMessage').html( durationTextTime );
			}
			function aCpI_msgLiveAudio_setNowTextTimeForAudioNowBySecond (iNthis,iNsecond) {
				var nowTextTime = moment( (iNsecond * 1000) || 0 ).format('mm:ss');
				$(iNthis).closest('.aCpI_msgLiveAudio_blockInAudioMsg').find('.aCpI_msgLiveAudio_timeNowInAudioMessage').html( nowTextTime );
			}
		function aCpI_msgLiveAudio_onHover (iNevent, iNobject) { 
	  		/*
	  			@discr
	  				mouse move on audio msg for moving audio 
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
		    var e = iNevent;
		    var thisObject = iNobject;

		    // get mouse position by percent
		    var mousePositionObject = global_getMousePositionByEvent(iNevent,iNobject);
		    var XinnerPercent 	= mousePositionObject['xPercent'];

		    // set progress bar
			var element = $(iNobject).children('.aCpI_msgLiveAudio_backgroundForAudioMsgOnHover');
		    aCpI_msgLiveAudio_setProgressBar (element,XinnerPercent,0);

			// get children audio element
		    var audioEl = $(iNobject).find('.aCpI_msgLiveAudio_hideAudioBlock audio').get(0);

	  		// get audio secund position by pass persent mouse x positoin
		    var audioTime = aCpI_msgLiveAudio_getCurrentTimeByPrecent (audioEl, XinnerPercent);

		    // set second text when mouse moving
		    aCpI_msgLiveAudio_setNowTextTimeForAudioNowBySecond (audioEl,audioTime);
	  	}

	  	function aCpI_msgLiveAudio_onClick (iNevent, iNobject) {
	  		/*
	  			@discr
	  				click audio msg fir start play
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
	  		// get children btnPlay element
		    var playBtn = $(iNobject).find('.aCpI_msgLiveAudio_blockInAudioMsg .aCpI_msgLiveAudio_controllPlayInAudioMessage')

	  		// get mouse position
		    var mousePositionObject = global_getMousePositionByEvent(iNevent,iNobject);


	  		// get mouse x position percent
		    var XinnerPercent 		= mousePositionObject['xPercent'];

	  		// get children audio element
		    var audioEl = $(iNobject).find('.aCpI_msgLiveAudio_hideAudioBlock audio').get(0);

	  		// get audio secund position by pass persent mouse x positoin
		    var audioTime = aCpI_msgLiveAudio_getCurrentTimeByPrecent (audioEl, XinnerPercent);

		    // set children audio need secund for start
		    aCpI_msgLiveAudio_setCurrentTimeByAudioEl (audioEl,audioTime);

		    // play children audio
		    aCpI_msgLiveAudio_playAudioOnClickBtnPlay (playBtn,iNevent);
	  	}

	  	function global_getMousePositionByEvent (iNevent,iNobject) {
	  		/*
	  			@discr
	  				GLOBAL FUNCTION get mouse position by Event, This
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			// position of element
		    var e 				= iNevent,
		     	thisObject = iNobject,
		    	resultObject	= {},
		    	pos 			= $(thisObject).offset(),
		    	width 			= $(thisObject).width(),
		    	height 			= $(thisObject).height();
		    var	elem_left 		= pos.left,
		    	elem_top 		= pos.top;
		    // position of cursor in this element
		    	resultObject['xPx']			= e.pageX - elem_left;
		    	resultObject['yPx'] 		= e.pageY - elem_top,
		    	resultObject['xPercent'] 	= resultObject['xPx']/width * 100,
		    	resultObject['yPercent'] 	= resultObject['yPx']/height * 100;

	    	return resultObject;
	  	}

	  	function aCpI_msgLiveAudio_onMouseOut (iNobject) {
	  		/*
	  			@discr
	  				when mouse out from audio msg element, set onHover progress bar
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			var element = $(iNobject).children('.aCpI_msgLiveAudio_backgroundForAudioMsgOnHover');
		    aCpI_msgLiveAudio_setProgressBar (element,0,500);
		}

		function aCpI_msgLiveAudio_getCurrentTimeByPrecent (iNaudioEl, iNpercent) {
	  		/*
	  			@discr
	  				get current audio time by passed percent
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			var element = iNaudioEl;
			var second = iNpercent * element.duration/100
			return second;
		}
		function aCpI_msgLiveAudio_setCurrentTimeByAudioEl (iNobject,iNcurentTime) {
			/*
	  			@discr
	  				set current time for audio element (iNobject)
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNcurentTime -> int (second)
	  		*/
			if ( typeof(iNcurentTime) == 'number' && isFinite(iNcurentTime)) {
	  			iNobject.currentTime = iNcurentTime;
	  		}
		}

		function aCpI_msgLiveAudio_onEventTimeUpdateForAuidioEl (thisAudioEl) {
	  		/*
	  			@discr
	  				attach time update
	  			@inputs
	  				@required
	  					thisAudioEl -> object (domElement)
	  		*/
	  		var parent 					= $(thisAudioEl).closest('.aCpI_msgLiveAudio_blockInAudioMsg');
	  		var onHoverBackgrounEl 		= $(thisAudioEl).closest('.aCpI_msgLiveAudio_contentOfAudioMessage').find('.aCpI_msgLiveAudio_backgroundForAudioMsgOnHover');
	  		var thisBackgroundEl 		= $(thisAudioEl).closest('.aCpI_msgLiveAudio_contentOfAudioMessage').find('.aCpI_msgLiveAudio_backgroundForAudioMsg');

	  		var percent = thisAudioEl.currentTime / thisAudioEl.duration * 100;

		  	let cssWidthBackgroundEl = parseInt($(onHoverBackgrounEl).css('width'));
		  	if(cssWidthBackgroundEl == 0)
				aCpI_msgLiveAudio_setNowTextTimeForAudioNow (thisAudioEl);

			aCpI_msgLiveAudio_setDurationTextTimeForAudioNow (thisAudioEl);


	    	aCpI_msgLiveAudio_setProgressBar (thisBackgroundEl,percent)
	    	if(percent >= 100){
	    		setTimeout(()=>{
			    	aCpI_msgLiveAudio_setProgressBar (thisBackgroundEl,0)
			    	aCpI_msgLiveAudio_smartViewBtnPlayAudio(parent);
	    			
	    		},500);
	    	}
		}

	  	function aCpI_msgLiveAudio_playAudioOnClickBtnPlay (iNobject,iNevent) {
	  		/*
	  			@discr
	  				onClick action for audio msg play btn
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNevent -> object (event)
	  		*/
	  		// stop parent callback for click event
	  		if (iNevent) {
		  		var e = iNevent;
		  		e.stopPropagation();
	  		}
	  		var thisPlayBtn = $(iNobject);
	  		var thisAudioEl = thisPlayBtn.nextAll('.aCpI_msgLiveAudio_hideAudioBlock').children('audio').get(0);

	  		thisAudioEl.play();
	  	}
  			function aCpI_msgLiveAudio_onEventPlay (iNobject) {
		  		//@GLOBAL pause all other audio & video is now playin
		  		aCpI_msg_pauseAllOtherPlayingAudioOrVideoEl();

		  		// add playing flags
		  		aCpI_msgLiveAudio_addPlayingFlags(iNobject);

		  		// view pause brn & hide play btn
	  			var parent = $(iNobject).closest('.aCpI_msgLiveAudio_blockInAudioMsg');
	  			aCpI_msgLiveAudio_smartViewBtnPauseAudio(parent);
  			}

				function aCpI_msgLiveAudio_addPlayingFlags (iNthis) {
					/*
			  			@discr
			  				add flag by addClass 'flagForSearchPlayingAudioOrVideo' && 'flagForSearchPlayingLiveAudio'
			  			@inputs
			  				@required
			  					iNthis -> object (this video el)
			  		*/
			  		$(iNthis)
			  			.addClass('flagForSearchPlayingAudioOrVideo')
			  			.addClass('flagForSearchPlayingLiveAudio');
				}

	  	function aCpI_msgLiveAudio_pauseAudioOnClickBtnPause (iNobject,iNevent) {
	  		/*
	  			@discr
	  				onClick action for audio msg pause btn
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNevent -> object (event)
	  		*/
	  		// stop parent callback for click event
	  		if (iNevent) {
		  		var e = iNevent;
		  		e.stopPropagation();
	  		}
	  		var thisPauseBtn = $(iNobject);
	  		var thisAudio = thisPauseBtn.nextAll('.aCpI_msgLiveAudio_hideAudioBlock').children('audio').get(0);

	  		thisAudio.pause();
	  	}
			
			function aCpI_msgLiveAudio_onEventPause (iNobject) {
				// del flag
				aCpI_msgLiveAudio_delPlayingFlags(iNobject);

  				var parent = $(iNobject).closest('.aCpI_msgLiveAudio_blockInAudioMsg');
				aCpI_msgLiveAudio_smartViewBtnPlayAudio(parent)
  			}
  				function aCpI_msgLiveAudio_delPlayingFlags (iNthis) {
					/*
			  			@discr
			  				delete flag by removeClass 'flagForSearchPlayingAudioOrVideo' && 'flagForSearchPlayingLiveAudio'
			  			@inputs
			  				@required
			  					iNthis -> object (this video el)
			  		*/
		  			$(iNthis)
			  			.removeClass('flagForSearchPlayingAudioOrVideo')
			  			.removeClass('flagForSearchPlayingLiveAudio');
				}

	  	function aCpI_msgLiveAudio_setProgressBar (iNel,iNpercent,iNtime) {
	  		/*
	  			@discr
	  				set css width for progress bar element (iNel) 
	  			@inputs
	  				@required
	  					iNel -> object (this)
	  					iNpercent -> int ()
	  					iNtime -> int (@animations length ms) 
	  		*/
	  		var time = iNtime || 500;
		    let percent = iNpercent.toFixed(2)+'%';
				iNel.clearQueue().stop();
			if( iNtime == 0 )
				iNel.css('width',percent);
			else
			    iNel.animate(
			    	{
		    			'width':percent
		    		},
		    		time
				);
	  	}

		function aCpI_msgLiveAudio_smartViewBtnPauseAudio(iNparent) {
	  			$(iNparent).children('.aCpI_msgLiveAudio_controllPlayInAudioMessage').hide();
	  			$(iNparent).children('.aCpI_msgLiveAudio_controllPauseInAudioMessage').show();
		}
		function aCpI_msgLiveAudio_smartViewBtnPlayAudio(iNparent) {
	  			$(iNparent).children('.aCpI_msgLiveAudio_controllPauseInAudioMessage').hide();
	  			$(iNparent).children('.aCpI_msgLiveAudio_controllPlayInAudioMessage').show();
		}
	//@> codeKey = appChatPageIndex - aCpI
</script>