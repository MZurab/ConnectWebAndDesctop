<div id="at2" class="messagesInChatView  toMeMessageInChatView msgTypeLiveAudio" time-sent="" time-read="" time-delivered="" connect_msg="" connect-appear-scroll-parent="#leftBlockInViewWindow" connect-appear-my-parent=".ChatViewInAppWindow">
   <div class="lineInToMeMessage">
      <div class="lineInBoxInLine">
         <div class="topCircleInMessages"></div>
         <div class="timeTopInMessages">04:12</div>
         <div class="botCircleInMessages" title="04:12"></div>
         <div class="timeBotInMessages">04:12</div>
      </div>
   </div>


   <div class="aCpI_contentAudioInToMeMessage aCpI_contentOfAudioMessage" onmousemove="aCpI_msgAudio_onHover(event, this)" onmouseout="aCpI_msgAudio_onMouseOut(this)" onclick="aCpI_msgAudio_onClick(event,this)">
      <div class="aCpI_audioMsgPlayedBlock">
         <div class="aCpI_playedSpritesInAudioMsg"></div>
      </div>
      <div class="aCpI_backgroundForAudioMsg aCpI_backgroundForAudioMsgToMe"></div>
      <div class="aCpI_backgroundForAudioMsgOnHover"></div>
      <div class="aCpI_blockInAudioMsg">
         <div class="aCpI_iconInAudioMessage"></div>
         <div class="aCpI_controllPlayInAudioMessage" onclick="aCpI_msgAudio_playAudioOnClickBtnPlay(this,event)"></div>
         <div class="aCpI_controllPauseInAudioMessage" onclick="aCpI_msgAudio_pauseAudioOnClickBtnPause(this,event)"></div>
         <div class="aCpI_hideAudioBlock">
            <audio class="audioSrc" preload="auto" src="https://firebasestorage.googleapis.com/v0/b/connect-9109d.appspot.com/o/public%2F5.mp3?alt=media&token=3d9a5872-cf9a-4ef1-85c3-f8deda4be672" onloadedmetadata="aCpI_msgAudio_onLoadedAudio(this)" ontimeupdate="aCpI_msgAudio_attachTimeUpdateForAuidioEl(this)"></audio>
         </div>
         <div class="aCpI_timeNowInAudioMessage aCpI_timeInAudioMsg"></div>
         <div class="aCpI_timeAllInAudioMessage aCpI_timeInAudioMsg"></div>
      </div>
   </div>
</div>


<div id="at3" class="messagesInChatView  fromMeMessageInChatView msgTypeLiveAudio" time-sent="" time-read="" time-delivered="" connect_msg="testAudio" connect-appear-scroll-parent="#leftBlockInViewWindow" connect-appear-my-parent=".ChatViewInAppWindow">
   <div class="lineInFromMeMessage">
      <div class="lineInBoxInLine">
         <div class="topCircleInMessages"></div>
         <div class="timeTopInMessages">04:12</div>
         <div class="botCircleInMessages" title="04:13"></div>
         <div class="timeBotInMessages">04:12</div>
      </div>
   </div>
   <div class="aCpI_contentAudioInFromMeMessage aCpI_contentOfAudioMessage" onmousemove="aCpI_msgAudio_onHover(event, this)" onmouseout="aCpI_msgAudio_onMouseOut(this)" onclick="aCpI_msgAudio_onClick(event,this)">
      <div class="aCpI_audioMsgPlayedBlock">
         <div class="aCpI_playedSpritesInAudioMsg"></div>
      </div>
      <div class="aCpI_backgroundForAudioMsg aCpI_backgroundForAudioMsgFromMe"></div>
      <div class="aCpI_backgroundForAudioMsgOnHover"></div>
      <div class="aCpI_blockInAudioMsg">
         <div class="aCpI_iconInAudioMessage"></div>
         <div class="aCpI_controllPlayInAudioMessage" onclick="aCpI_msgAudio_playAudioOnClickBtnPlay(this,event)"></div>
         <div class="aCpI_controllPauseInAudioMessage" onclick="aCpI_msgAudio_pauseAudioOnClickBtnPause(this,event)"></div>
         <div class="aCpI_hideAudioBlock">
            <audio class="audioSrc" preload="auto" src="https://firebasestorage.googleapis.com/v0/b/connect-9109d.appspot.com/o/public%2F12.ogg?alt=media&amp;token=bf77f013-c3c3-4a8f-8519-fa1f352637d7" onloadedmetadata="aCpI_msgAudio_onLoadedAudio(this)" ontimeupdate="aCpI_msgAudio_attachTimeUpdateForAuidioEl(this)"></audio>
         </div>
         <div class="aCpI_timeNowInAudioMessage aCpI_timeInAudioMsg"></div>
         <div class="aCpI_timeAllInAudioMessage aCpI_timeInAudioMsg"></div>
      </div>
   </div>
</div>



<style type="text/css">
	/*@< codeKey = aCpI - appChatPageIndex  */
		.aCpI_contentAudioInToMeMessage {
		    height: 4rem;
		    max-width: 80%;
		    display: block;
		    width: 25rem;
		    margin-left: 0.9rem;
		    background: white;
		    border-radius: 0 0.3rem 0.3rem 0;
		    font-size: 1.2rem;
		    float: left;
		    position: relative;
		}
			.aCpI_userNameBlockInAudioMsg {
			    position: absolute;
			    font-size: 0.9rem;
			    top: -1.2rem;
			    right: 0px;
			    color: #1cb5e1;
			    font-weight: 900;
			    font-family: sans-serif;
			}
			/*ms*/
			.aCpI_audioMsgPlayedBlock {
			    position: absolute;
			    width: 100%;
			    bottom: -0.25rem;
			    height: 0.25rem;
			    display: none; /* CHANGE - add spy*/
			}
			.aCpI_playedSpritesInAudioMsg {
			    background-color: rgb(36, 208, 168);
			    height: 100%;
			    position: absolute;
			    width: 100%;
			    left: 0%;
			}
			/**/
			.aCpI_backgroundForAudioMsgFromMe {
			    background: rgba(255, 0, 59, 0.25);
			}
			.aCpI_backgroundForAudioMsgToMe {
			    background: rgba(28, 181, 225, 0.4);
			}
			.aCpI_backgroundForAudioMsg {
			    height: 100%;
			    width: 0%;
			    position: absolute;
			    border-radius: inherit;

			}

			.aCpI_backgroundForAudioMsgOnHover {
			    position: absolute;
			    height: 100%;
			    width: 0%;
			    background: rgba(114, 93, 149, 0.15);
			    border-radius: inherit;
			}

			.aCpI_blockInAudioMsg {
			    width: 100%;
			    height: 100%;
			    position: relative;
			    margin: 0.25rem;
			}
				.aCpI_iconInAudioMessage {
				    width: 3.5rem;
				    height: 3.5rem;
				    background-image: url(https://cdn.ramman.net/images/icons/users/zurab.jpg);
				    background-size: 100%;
				    border-radius: 100%;
				    position: absolute;
				    top: 0px;
				    left: 0px;
				}
				.aCpI_controllPlayInAudioMessage {
				    position: absolute;
				    width: 2.5rem;
				    height: 2.5rem;
				    left: 4rem;
				    top: 0.6rem;
				    background-image: url(https://cdn.ramman.net/web/res/images/icons/message/audio/sprite.png);
				    background-size: auto 200%;
				    background-position-x: 198%;
				    cursor: pointer;
				}
				.aCpI_controllPauseInAudioMessage {
				    position: absolute;
				    width: 2.5rem;
				    height: 2.5rem;
				    left: 4rem;
				    top: 0.5rem;
				    background-image: url(https://cdn.ramman.net/web/res/images/icons/message/audio/sprite.png);
				    background-size: auto 200%;
				    background-position-x: 198%;
				    background-position-y: 100%;
				    cursor: pointer;
				    display:none;
				}
				.aCpI_hideAudioBlock {
					display: none;
				}
				.aCpI_timeInAudioMsg {
				    font-size: 0.9rem;
				    position: absolute;
				    bottom: 0.5rem;
				    font-family: sans-serif;
				}
				.aCpI_timeNowInAudioMessage {
				    left: 7rem;
				}
				.aCpI_timeAllInAudioMessage {
				    right: 0.5rem;
				}

		.aCpI_contentAudioInFromMeMessage {
		    height: 4rem;
		    max-width: 80%;
		    display: block;
		    width: 25rem;
		    margin-right: 0.9rem;
		    background: white;
		    border-radius: 0.3rem 0 0 0.3rem;
		    font-size: 1.2rem;
		    float: right;
		    position: relative;
		}
		.aCpI_contentOfAudioMessage {
			cursor: pointer;
		}
	/*@> codeKey = aCpI - appChatPageIndex  */
</style>

<script type="text/javascript">
	//@< codeKey = appChatPageIndex - aCpI
		function aCpI_msgAudio_onLoadedAudio (iNthis) {
			aCpI_msgAudio_setNowTextTimeForAudioNow (iNthis);
			aCpI_msgAudio_setDurationTextTimeForAudioNow (iNthis);
		}
			function aCpI_msgAudio_setNowTextTimeForAudioNow (iNthis) {
				var nowTextTime = moment( (iNthis.currentTime * 1000) || 0).format('mm:ss');
				$(iNthis).closest('.aCpI_blockInAudioMsg').find('.aCpI_timeNowInAudioMessage').html( nowTextTime );
			}
			function aCpI_msgAudio_setDurationTextTimeForAudioNow (iNthis) {
				var durationTextTime = moment( (iNthis.duration * 1000) || 0 ).format('mm:ss');
				$(iNthis).closest('.aCpI_blockInAudioMsg').find('.aCpI_timeAllInAudioMessage').html( durationTextTime );
			}
			function aCpI_msgAudio_setNowTextTimeForAudioNowBySecond (iNthis,iNsecond) {
				var nowTextTime = moment( (iNsecond * 1000) || 0 ).format('mm:ss');
				$(iNthis).closest('.aCpI_blockInAudioMsg').find('.aCpI_timeNowInAudioMessage').html( nowTextTime );
			}
		function aCpI_msgAudio_onHover (iNevent, iNobject) { 
	  		/*
	  			@discr
	  				mouse move on audio msg for moving audio 
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
		    var e = iNevent;
		    var thisObject = iNobject;

		    // get mouse position by percent
		    var mousePositionObject = global_getMousePositionByEvent(iNevent,iNobject);
		    var XinnerPercent 	= mousePositionObject['xPercent'];

		    // set progress bar
			var element = $(iNobject).children('.aCpI_backgroundForAudioMsgOnHover');
		    aCpI_msgAudio_setProgressBar (element,XinnerPercent,0);

			// get children audio element
		    var audioEl = $(iNobject).find('.aCpI_hideAudioBlock audio').get(0);

	  		// get audio secund position by pass persent mouse x positoin
		    var audioTime = aCpI_msgAudio_getCurrentTimeByPrecent (audioEl, XinnerPercent);

		    // set second text when mouse moving
		    aCpI_msgAudio_setNowTextTimeForAudioNowBySecond (audioEl,audioTime);
	  	}

	  	function aCpI_msgAudio_onClick (iNevent, iNobject) {
	  		/*
	  			@discr
	  				click audio msg fir start play
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
	  		// get children btnPlay element
		    var playBtn = $(iNobject).find('.aCpI_blockInAudioMsg .aCpI_controllPlayInAudioMessage')

	  		// get mouse position
		    var mousePositionObject = global_getMousePositionByEvent(iNevent,iNobject);


	  		// get mouse x position percent
		    var XinnerPercent 		= mousePositionObject['xPercent'];

	  		// get children audio element
		    var audioEl = $(iNobject).find('.aCpI_hideAudioBlock audio').get(0);

	  		// get audio secund position by pass persent mouse x positoin
		    var audioTime = aCpI_msgAudio_getCurrentTimeByPrecent (audioEl, XinnerPercent);

		    // set children audio need secund for start
		    aCpI_msgAudio_setCurrentTimeByAudioEl (audioEl,audioTime);

		    // play children audio
		    aCpI_msgAudio_playAudioOnClickBtnPlay (playBtn,iNevent);
	  	}

	  	function global_getMousePositionByEvent (iNevent,iNobject) {
	  		/*
	  			@discr
	  				GLOBAL FUNCTION get mouse position by Event, This
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			// position of element
		    var e 				= iNevent,
		     	thisObject = iNobject,
		    	resultObject	= {},
		    	pos 			= $(thisObject).offset(),
		    	width 			= $(thisObject).width(),
		    	height 			= $(thisObject).height();
		    var	elem_left 		= pos.left,
		    	elem_top 		= pos.top;
		    // position of cursor in this element
		    	resultObject['xPx']			= e.pageX - elem_left;
		    	resultObject['yPx'] 		= e.pageY - elem_top,
		    	resultObject['xPercent'] 	= resultObject['xPx']/width * 100,
		    	resultObject['yPercent'] 	= resultObject['yPx']/height * 100;

	    	return resultObject;
	  	}

	  	function aCpI_msgAudio_onMouseOut (iNobject) {
	  		/*
	  			@discr
	  				when mouse out from audio msg element, set onHover progress bar
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			var element = $(iNobject).children('.aCpI_backgroundForAudioMsgOnHover');
		    aCpI_msgAudio_setProgressBar (element,0,500);
		}

		function aCpI_msgAudio_getCurrentTimeByPrecent (iNaudioEl, iNpercent) {
	  		/*
	  			@discr
	  				get current audio time by passed percent
	  			@inputs
	  				@required
	  					iNevent -> object (event)
	  					iNobject -> object (this)
	  		*/
			var element = iNaudioEl;
			var second = iNpercent * element.duration/100
			return second;
		}
		function aCpI_msgAudio_playAudioByAudioEl (iNobject) {
	  		/*
	  			@discr
	  				play audio element (iNobject)
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  		*/
	  		iNobject.play();
		}
		function aCpI_msgAudio_setCurrentTimeByAudioEl (iNobject,iNcurentTime) {
			/*
	  			@discr
	  				set current time for audio element (iNobject)
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNcurentTime -> int (second)
	  		*/
			if ( typeof(iNcurentTime) == 'number' && isFinite(iNcurentTime)) {
	  			iNobject.currentTime = iNcurentTime;
	  		}
		}

		function aCpI_msgAudio_attachTimeUpdateForAuidioEl (thisAudioEl) {
	  		/*
	  			@discr
	  				attach time update
	  			@inputs
	  				@required
	  					thisAudioEl -> object (domElement)
	  		*/
	  		var parent 					= $(thisAudioEl).closest('.aCpI_blockInAudioMsg');
	  		var onHoverBackgrounEl 		= $(thisAudioEl).closest('.aCpI_contentOfAudioMessage').find('.aCpI_backgroundForAudioMsgOnHover');
	  		var thisBackgroundEl 		= $(thisAudioEl).closest('.aCpI_contentOfAudioMessage').find('.aCpI_backgroundForAudioMsg');

	  		var percent = thisAudioEl.currentTime / thisAudioEl.duration * 100;

		  	let cssWidthBackgroundEl = parseInt($(onHoverBackgrounEl).css('width'));
		  	if(cssWidthBackgroundEl == 0)
				aCpI_msgAudio_setNowTextTimeForAudioNow (thisAudioEl);

			aCpI_msgAudio_setDurationTextTimeForAudioNow (thisAudioEl);


	    	aCpI_msgAudio_setProgressBar (thisBackgroundEl,percent)
	    	if(percent >= 100){
	    		setTimeout(()=>{
			    	aCpI_msgAudio_setProgressBar (thisBackgroundEl,0)
			    	aCpI_msgAudio_smartViewBtnPlayAudio(parent);
	    			
	    		},500);
	    	}
		}

	  	function aCpI_msgAudio_playAudioOnClickBtnPlay (iNobject,iNevent) {
	  		/*
	  			@discr
	  				onClick action for audio msg play btn
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNevent -> object (event)
	  		*/
	  		// stop parent callback for click event
	  		if (iNevent) {
		  		var e = iNevent;
		  		e.stopPropagation();
	  		}

	  		var lastPlayingMessage = $('.msgTypeLiveAudio.flagLogicPlaying');
	  		
	  		if(lastPlayingMessage.length > 0){
	  			//stop messages
	  			// $(lastPlayingMessage).find('.aCpI_controllPauseInAudioMessage');
	  			aCpI_msgAudio_pauseAudioOnClickBtnPause($(lastPlayingMessage).find('.aCpI_controllPauseInAudioMessage'));
	  			//del flag
	  			$(lastPlayingMessage).removeClass('flagLogicPlaying');
	  		}
	  		$(iNobject).closest('.msgTypeLiveAudio').addClass('flagLogicPlaying');


	  		var thisPlayBtn = $(iNobject);
	  		var thisAudioEl = thisPlayBtn.nextAll('.aCpI_hideAudioBlock').children('audio').get(0);
	  		// var thisBackgroundEl = thisPlayBtn.closest('.aCpI_contentOfAudioMessage').children('.aCpI_backgroundForAudioMsg');
	  		var parent = $(iNobject).closest('.aCpI_blockInAudioMsg');
	  		
	  		// play children audio element
	  		aCpI_msgAudio_playAudioByAudioEl (thisAudioEl)

	  		// aCpI_msgAudio_attachTimeUpdateForAuidioEl (thisAudioEl,thisBackgroundEl)


	  		aCpI_msgAudio_smartViewBtnPauseAudio(parent);
	  		//aCpI_msgAudio_changeBtnsPlayAndPause(parent);
	  	}

	  	function aCpI_msgAudio_pauseAudioOnClickBtnPause (iNobject,iNevent) {
	  		/*
	  			@discr
	  				onClick action for audio msg pause btn
	  			@inputs
	  				@required
	  					iNobject -> object (this)
	  					iNevent -> object (event)
	  		*/
	  		// stop parent callback for click event
	  		if (iNevent) {
		  		var e = iNevent;
		  		e.stopPropagation();
	  		}
	  		var thisPauseBtn = $(iNobject);
	  		var thisAudio = thisPauseBtn.nextAll('.aCpI_hideAudioBlock').children('audio').get(0);

	  		thisAudio.pause();

	  		var parent = $(iNobject).closest('.aCpI_blockInAudioMsg');

	  		aCpI_msgAudio_smartViewBtnPlayAudio(parent)
	  		// aCpI_msgAudio_changeBtnsPlayAndPause(parent);
	  	}

	  	function aCpI_msgAudio_setProgressBar (iNel,iNpercent,iNtime) {
	  		/*
	  			@discr
	  				set css width for progress bar element (iNel) 
	  			@inputs
	  				@required
	  					iNel -> object (this)
	  					iNpercent -> int ()
	  					iNtime -> int (@animations length ms) 
	  		*/
	  		var time = iNtime || 500;
		    let percent = iNpercent.toFixed(2)+'%';
				iNel.clearQueue().stop();
			if( iNtime == 0 )
				iNel.css('width',percent);
			else
			    iNel.animate(
			    	{
		    			'width':percent
		    		},
		    		time
				);
	  	}

	 //  	function aCpI_msgAudio_changeBtnsPlayAndPause (iNparent) {
	 //  		/*
	 //  			@discr
	 //  				set css width for progress bar element (iNel) 
	 //  			@inputs
	 //  				@required
	 //  					iNparent -> object (this)
	 //  		*/
	 //  		var attrDisplay = $(iNparent).children('.aCpI_controllPauseInAudioMessage').css('display');
	 //  		if ( attrDisplay != 'none' ) {
	 //  			aCpI_msgAudio_smartViewBtnPlayAudio(iNparent);
	 //  		} else {
	 //  			aCpI_msgAudio_smartViewBtnPauseAudio(iNparent);
		// 	}
		// }

		function aCpI_msgAudio_smartViewBtnPauseAudio(iNparent) {
	  			$(iNparent).children('.aCpI_controllPlayInAudioMessage').hide();
	  			$(iNparent).children('.aCpI_controllPauseInAudioMessage').show();
		}
		function aCpI_msgAudio_smartViewBtnPlayAudio(iNparent) {
	  			$(iNparent).children('.aCpI_controllPauseInAudioMessage').hide();
	  			$(iNparent).children('.aCpI_controllPlayInAudioMessage').show();
		}
	//@> codeKey = appChatPageIndex - aCpI
</script>